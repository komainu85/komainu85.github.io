<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=16767c114f45dae4d35b19539cb7a3826e5840d3" media="screen" type="text/css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print" type="text/css">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- Begin Jekyll SEO tag v2.2.3 -->
<title>Workflow RSS Feed Custom Email Action | Mike Robbins</title>
<meta property="og:title" content="Workflow RSS Feed Custom Email Action" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I have worked with a number of clients that have asked why the email notifications they receive from workflow didn&#39;t reflect what is available from the RSS feed within the workbox. This seems to have been a goal of a number of developers in the past, but nothing concrete has been created to replicate the feature. There is a awesome workaround from Nick Wesselman using Rss2email. http://www.techphoria414.com/Blog/2012/April/Sitecore_Workflow_Emails_with_rss2email As part of a recent hacking session I decided to see if I could replicate the RSS feed within a more advance email action. Solution The solution is available as a Sitecore package on the marketplace or the source is available of GitHub at the bottom of this blog. Please feel free to extend and contribute. Workflow history Using the GetWorkflow().GetHistory(Item) API gives full access to the entire workflow history or a particular Sitecore Item. [code language=&quot;csharp&quot;] var workflowItemHistory = Item.State.GetWorkflow().GetHistory(Item); [/code] However on testing this code threw up an unexpected error. Due to the email action being called from a command the workflow command hasn&#39;t been fully executed, so the workflow history doesn&#39;t contain the currently executing workflow command. This was solved by creating a function that gets the current workflow command that has fired, working out the target state of the action before appending this data to a collection of workflow history. [code language=&quot;csharp&quot;] private ItemWorkflowHistory GetCurrentWorkflowHistoryItem() { var history = new ItemWorkflowHistory() { ItemDateTime = DateTime.Now, User = Sitecore.Context.GetUserName(), PreviousState = workflowPipelineArgs.DataItem.State.GetWorkflowState().DisplayName, CurrentState = GetCorrectWorkflowState().DisplayName, Comment = workflowPipelineArgs.Comments }; return history; } private WorkflowState GetCorrectWorkflowState() { var emailAction = GetEmailAction(); var command = emailAction.Parent; var nextStateId = command[&amp;amp;amp;amp;quot;Next state&amp;amp;amp;amp;quot;]; var itemWorkflow = Sitecore.Data.Database.GetDatabase(&amp;amp;amp;amp;quot;master&amp;amp;amp;amp;quot;).WorkflowProvider.GetWorkflow(workflowPipelineArgs.DataItem); return itemWorkflow.GetState(nextStateId.ToString()); } [/code] Workflow commands The biggest challenge was to build the command links to allow the user to fire the correct commands at the relevant stage of workflow. This suffered from the same issue as the workflow history, the correct workflow commands weren&#39;t shown because the currently executing command hasn&#39;t completed. Again this was solved using the method above of getting the firing command and getting its target state of workflow. The correct workflow commands can then be taken from this target state of workflow. [code language=&quot;csharp&quot;] private string GetCommandLinks(Item workflowItem, WorkflowState state) { var sb = new StringBuilder(); var workflow = Sitecore.Data.Database.GetDatabase(&amp;amp;amp;amp;amp;quot;master&amp;amp;amp;amp;amp;quot;).WorkflowProvider.GetWorkflow(workflowItem); var commands = workflow.GetCommands(state.StateID); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;ul&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); foreach (var command in commands) { var submit = Tools.GetContentEditorLink(ContentEditorMode.Submit, workflowItem, HostName, new ID(command.CommandID)); var submitComment = Tools.GetContentEditorLink(ContentEditorMode.Submit, workflowItem,HostName, new ID(command.CommandID)); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot; + command.DisplayName + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;/a&amp;amp;amp;amp;amp;gt; or &amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot; + command.DisplayName + &amp;amp;amp;amp;amp;quot; &amp;amp;amp;amp;amp;amp;amp; comment&amp;amp;amp;amp;amp;lt;/a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); } string editLink = Tools.GetContentEditorLink(ContentEditorMode.Editor, workflowItem, HostName, ID.NewID); string previewLink = Tools.GetContentEditorLink(ContentEditorMode.Preview, workflowItem,HostName, ID.NewID); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;Edit&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;Preview&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a /&amp;amp;amp;amp;amp;gt;Workbox&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;/ul&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); return sb.ToString(); } [/code] Reviewing the command links in the Workbox RSS feed I was able to build a helper class to build the command links in the correct URL format for the links. [code language=&quot;csharp&quot;] public static string GetContentEditorLink(ContentEditorMode contentEditorMode, Item item, string hostName, ID commandId) { switch (contentEditorMode) { case ContentEditorMode.Editor: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/Applications/Content%20editor.aspx?fo=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;sc_bw=1&amp;amp;amp;amp;amp;quot;); case ContentEditorMode.Preview: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Preview&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString()); case ContentEditorMode.Submit: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Workflow&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;cmd=&amp;amp;amp;amp;amp;quot; + commandId.ToString()); case ContentEditorMode.SubmitComment: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;,&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Workflow&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;cmd=&amp;amp;amp;amp;amp;quot; + commandId.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;nc=1&amp;amp;amp;amp;amp;quot;); } return &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;; } } [/code] Workflow History Source https://github.com/komainu85/AdvancedEmailAction Sitecore Marketplace https://marketplace.sitecore.net/en/Modules/Sitecore_Advanced_Email_Action.aspx" />
<meta property="og:description" content="I have worked with a number of clients that have asked why the email notifications they receive from workflow didn&#39;t reflect what is available from the RSS feed within the workbox. This seems to have been a goal of a number of developers in the past, but nothing concrete has been created to replicate the feature. There is a awesome workaround from Nick Wesselman using Rss2email. http://www.techphoria414.com/Blog/2012/April/Sitecore_Workflow_Emails_with_rss2email As part of a recent hacking session I decided to see if I could replicate the RSS feed within a more advance email action. Solution The solution is available as a Sitecore package on the marketplace or the source is available of GitHub at the bottom of this blog. Please feel free to extend and contribute. Workflow history Using the GetWorkflow().GetHistory(Item) API gives full access to the entire workflow history or a particular Sitecore Item. [code language=&quot;csharp&quot;] var workflowItemHistory = Item.State.GetWorkflow().GetHistory(Item); [/code] However on testing this code threw up an unexpected error. Due to the email action being called from a command the workflow command hasn&#39;t been fully executed, so the workflow history doesn&#39;t contain the currently executing workflow command. This was solved by creating a function that gets the current workflow command that has fired, working out the target state of the action before appending this data to a collection of workflow history. [code language=&quot;csharp&quot;] private ItemWorkflowHistory GetCurrentWorkflowHistoryItem() { var history = new ItemWorkflowHistory() { ItemDateTime = DateTime.Now, User = Sitecore.Context.GetUserName(), PreviousState = workflowPipelineArgs.DataItem.State.GetWorkflowState().DisplayName, CurrentState = GetCorrectWorkflowState().DisplayName, Comment = workflowPipelineArgs.Comments }; return history; } private WorkflowState GetCorrectWorkflowState() { var emailAction = GetEmailAction(); var command = emailAction.Parent; var nextStateId = command[&amp;amp;amp;amp;quot;Next state&amp;amp;amp;amp;quot;]; var itemWorkflow = Sitecore.Data.Database.GetDatabase(&amp;amp;amp;amp;quot;master&amp;amp;amp;amp;quot;).WorkflowProvider.GetWorkflow(workflowPipelineArgs.DataItem); return itemWorkflow.GetState(nextStateId.ToString()); } [/code] Workflow commands The biggest challenge was to build the command links to allow the user to fire the correct commands at the relevant stage of workflow. This suffered from the same issue as the workflow history, the correct workflow commands weren&#39;t shown because the currently executing command hasn&#39;t completed. Again this was solved using the method above of getting the firing command and getting its target state of workflow. The correct workflow commands can then be taken from this target state of workflow. [code language=&quot;csharp&quot;] private string GetCommandLinks(Item workflowItem, WorkflowState state) { var sb = new StringBuilder(); var workflow = Sitecore.Data.Database.GetDatabase(&amp;amp;amp;amp;amp;quot;master&amp;amp;amp;amp;amp;quot;).WorkflowProvider.GetWorkflow(workflowItem); var commands = workflow.GetCommands(state.StateID); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;ul&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); foreach (var command in commands) { var submit = Tools.GetContentEditorLink(ContentEditorMode.Submit, workflowItem, HostName, new ID(command.CommandID)); var submitComment = Tools.GetContentEditorLink(ContentEditorMode.Submit, workflowItem,HostName, new ID(command.CommandID)); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot; + command.DisplayName + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;/a&amp;amp;amp;amp;amp;gt; or &amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot; + command.DisplayName + &amp;amp;amp;amp;amp;quot; &amp;amp;amp;amp;amp;amp;amp; comment&amp;amp;amp;amp;amp;lt;/a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); } string editLink = Tools.GetContentEditorLink(ContentEditorMode.Editor, workflowItem, HostName, ID.NewID); string previewLink = Tools.GetContentEditorLink(ContentEditorMode.Preview, workflowItem,HostName, ID.NewID); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;Edit&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;Preview&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a /&amp;amp;amp;amp;amp;gt;Workbox&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;/ul&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); return sb.ToString(); } [/code] Reviewing the command links in the Workbox RSS feed I was able to build a helper class to build the command links in the correct URL format for the links. [code language=&quot;csharp&quot;] public static string GetContentEditorLink(ContentEditorMode contentEditorMode, Item item, string hostName, ID commandId) { switch (contentEditorMode) { case ContentEditorMode.Editor: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/Applications/Content%20editor.aspx?fo=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;sc_bw=1&amp;amp;amp;amp;amp;quot;); case ContentEditorMode.Preview: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Preview&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString()); case ContentEditorMode.Submit: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Workflow&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;cmd=&amp;amp;amp;amp;amp;quot; + commandId.ToString()); case ContentEditorMode.SubmitComment: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;,&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Workflow&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;cmd=&amp;amp;amp;amp;amp;quot; + commandId.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;nc=1&amp;amp;amp;amp;amp;quot;); } return &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;; } } [/code] Workflow History Source https://github.com/komainu85/AdvancedEmailAction Sitecore Marketplace https://marketplace.sitecore.net/en/Modules/Sitecore_Advanced_Email_Action.aspx" />
<link rel="canonical" href="http://localhost:4000/email/sitecore/workflow/2014/04/14/workflow-rss-feed-custom-email-action.html" />
<meta property="og:url" content="http://localhost:4000/email/sitecore/workflow/2014/04/14/workflow-rss-feed-custom-email-action.html" />
<meta property="og:site_name" content="Mike Robbins" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-04-14T18:37:52+01:00" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Workflow RSS Feed Custom Email Action","author":{"@type":"Person","name":null},"datePublished":"2014-04-14T18:37:52+01:00","dateModified":"2014-04-14T18:37:52+01:00","description":"I have worked with a number of clients that have asked why the email notifications they receive from workflow didn&#39;t reflect what is available from the RSS feed within the workbox. This seems to have been a goal of a number of developers in the past, but nothing concrete has been created to replicate the feature. There is a awesome workaround from Nick Wesselman using Rss2email. http://www.techphoria414.com/Blog/2012/April/Sitecore_Workflow_Emails_with_rss2email As part of a recent hacking session I decided to see if I could replicate the RSS feed within a more advance email action. Solution The solution is available as a Sitecore package on the marketplace or the source is available of GitHub at the bottom of this blog. Please feel free to extend and contribute. Workflow history Using the GetWorkflow().GetHistory(Item) API gives full access to the entire workflow history or a particular Sitecore Item. [code language=&quot;csharp&quot;] var workflowItemHistory = Item.State.GetWorkflow().GetHistory(Item); [/code] However on testing this code threw up an unexpected error. Due to the email action being called from a command the workflow command hasn&#39;t been fully executed, so the workflow history doesn&#39;t contain the currently executing workflow command. This was solved by creating a function that gets the current workflow command that has fired, working out the target state of the action before appending this data to a collection of workflow history. [code language=&quot;csharp&quot;] private ItemWorkflowHistory GetCurrentWorkflowHistoryItem() { var history = new ItemWorkflowHistory() { ItemDateTime = DateTime.Now, User = Sitecore.Context.GetUserName(), PreviousState = workflowPipelineArgs.DataItem.State.GetWorkflowState().DisplayName, CurrentState = GetCorrectWorkflowState().DisplayName, Comment = workflowPipelineArgs.Comments }; return history; } private WorkflowState GetCorrectWorkflowState() { var emailAction = GetEmailAction(); var command = emailAction.Parent; var nextStateId = command[&amp;amp;amp;amp;quot;Next state&amp;amp;amp;amp;quot;]; var itemWorkflow = Sitecore.Data.Database.GetDatabase(&amp;amp;amp;amp;quot;master&amp;amp;amp;amp;quot;).WorkflowProvider.GetWorkflow(workflowPipelineArgs.DataItem); return itemWorkflow.GetState(nextStateId.ToString()); } [/code] Workflow commands The biggest challenge was to build the command links to allow the user to fire the correct commands at the relevant stage of workflow. This suffered from the same issue as the workflow history, the correct workflow commands weren&#39;t shown because the currently executing command hasn&#39;t completed. Again this was solved using the method above of getting the firing command and getting its target state of workflow. The correct workflow commands can then be taken from this target state of workflow. [code language=&quot;csharp&quot;] private string GetCommandLinks(Item workflowItem, WorkflowState state) { var sb = new StringBuilder(); var workflow = Sitecore.Data.Database.GetDatabase(&amp;amp;amp;amp;amp;quot;master&amp;amp;amp;amp;amp;quot;).WorkflowProvider.GetWorkflow(workflowItem); var commands = workflow.GetCommands(state.StateID); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;ul&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); foreach (var command in commands) { var submit = Tools.GetContentEditorLink(ContentEditorMode.Submit, workflowItem, HostName, new ID(command.CommandID)); var submitComment = Tools.GetContentEditorLink(ContentEditorMode.Submit, workflowItem,HostName, new ID(command.CommandID)); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot; + command.DisplayName + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;/a&amp;amp;amp;amp;amp;gt; or &amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot; + command.DisplayName + &amp;amp;amp;amp;amp;quot; &amp;amp;amp;amp;amp;amp;amp; comment&amp;amp;amp;amp;amp;lt;/a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); } string editLink = Tools.GetContentEditorLink(ContentEditorMode.Editor, workflowItem, HostName, ID.NewID); string previewLink = Tools.GetContentEditorLink(ContentEditorMode.Preview, workflowItem,HostName, ID.NewID); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;Edit&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;Preview&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a /&amp;amp;amp;amp;amp;gt;Workbox&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;/ul&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;); return sb.ToString(); } [/code] Reviewing the command links in the Workbox RSS feed I was able to build a helper class to build the command links in the correct URL format for the links. [code language=&quot;csharp&quot;] public static string GetContentEditorLink(ContentEditorMode contentEditorMode, Item item, string hostName, ID commandId) { switch (contentEditorMode) { case ContentEditorMode.Editor: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/Applications/Content%20editor.aspx?fo=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;sc_bw=1&amp;amp;amp;amp;amp;quot;); case ContentEditorMode.Preview: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Preview&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString()); case ContentEditorMode.Submit: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Workflow&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;cmd=&amp;amp;amp;amp;amp;quot; + commandId.ToString()); case ContentEditorMode.SubmitComment: return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;,&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Workflow&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;cmd=&amp;amp;amp;amp;amp;quot; + commandId.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;nc=1&amp;amp;amp;amp;amp;quot;); } return &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;; } } [/code] Workflow History Source https://github.com/komainu85/AdvancedEmailAction Sitecore Marketplace https://marketplace.sitecore.net/en/Modules/Sitecore_Advanced_Email_Action.aspx","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/email/sitecore/workflow/2014/04/14/workflow-rss-feed-custom-email-action.html"},"url":"http://localhost:4000/email/sitecore/workflow/2014/04/14/workflow-rss-feed-custom-email-action.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <header>
      <div class="inner">
        <a href="http://localhost:4000/">
          <h1>Mike Robbins</h1>
        </a>
        <h2>Sitecore Developer Blog
</h2>
        
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>Workflow RSS Feed Custom Email Action</h1>
          <p>I have worked with a number of clients that have asked why the email notifications they receive from workflow didn't reflect what is available from the RSS feed within the workbox.</p>
<p>This seems to have been a goal of a number of developers in the past, but nothing concrete has been created to replicate the feature. There is a awesome workaround from Nick Wesselman using Rss2email. http://www.techphoria414.com/Blog/2012/April/Sitecore_Workflow_Emails_with_rss2email</p>
<p>As part of a recent hacking session I decided to see if I could replicate the RSS feed within a more advance email action.</p>
<p><strong>Solution</strong><br />
The solution is available as a Sitecore package on the marketplace or the source is available of GitHub at the bottom of this blog. Please feel free to extend and contribute.</p>
<p><strong>Workflow history</strong></p>
<p>Using the GetWorkflow().GetHistory(Item) API gives full access to the entire workflow history or a particular Sitecore Item.</p>
<p>[code language="csharp"]<br />
   var workflowItemHistory = Item.State.GetWorkflow().GetHistory(Item);<br />
[/code]</p>
<p>However on testing this code threw up an unexpected error. Due to the email action being called from a command the workflow command hasn't been fully executed, so the workflow history doesn't contain the currently executing workflow command. This was solved by creating a function that gets the current workflow command that has fired, working out the target state of the action before appending this data to a collection of workflow history.</p>
<p>[code language="csharp"]<br />
        private ItemWorkflowHistory GetCurrentWorkflowHistoryItem()<br />
        {</p>
<p>            var history = new ItemWorkflowHistory()<br />
            {<br />
                ItemDateTime = DateTime.Now,<br />
                User = Sitecore.Context.GetUserName(),<br />
                PreviousState = workflowPipelineArgs.DataItem.State.GetWorkflowState().DisplayName,<br />
                CurrentState = GetCorrectWorkflowState().DisplayName,<br />
                Comment = workflowPipelineArgs.Comments<br />
            };</p>
<p>            return history;<br />
        }</p>
<p>private WorkflowState GetCorrectWorkflowState()<br />
        {<br />
            var emailAction = GetEmailAction();</p>
<p>            var command = emailAction.Parent;</p>
<p>            var nextStateId = command[&amp;amp;amp;amp;quot;Next state&amp;amp;amp;amp;quot;];</p>
<p>            var itemWorkflow = Sitecore.Data.Database.GetDatabase(&amp;amp;amp;amp;quot;master&amp;amp;amp;amp;quot;).WorkflowProvider.GetWorkflow(workflowPipelineArgs.DataItem);</p>
<p>            return itemWorkflow.GetState(nextStateId.ToString());<br />
        }<br />
[/code]</p>
<p><strong>Workflow commands</strong><br />
The biggest challenge was to build the command links to allow the user to fire the correct commands at the relevant stage of workflow.</p>
<p>This suffered from the same issue as the workflow history, the correct workflow commands weren't shown because the currently executing command hasn't completed. Again this was solved using the method above of getting the firing command and getting its target state of workflow. The correct workflow commands can then be taken from this target state of workflow.</p>
<p>[code language="csharp"]<br />
private string GetCommandLinks(Item workflowItem, WorkflowState state)<br />
        {<br />
            var sb = new StringBuilder();</p>
<p>            var workflow = Sitecore.Data.Database.GetDatabase(&amp;amp;amp;amp;amp;quot;master&amp;amp;amp;amp;amp;quot;).WorkflowProvider.GetWorkflow(workflowItem);</p>
<p>            var commands = workflow.GetCommands(state.StateID);</p>
<p>            sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;ul&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;);</p>
<p>            foreach (var command in commands)<br />
            {<br />
                var submit = Tools.GetContentEditorLink(ContentEditorMode.Submit, workflowItem, HostName, new ID(command.CommandID));<br />
                var submitComment = Tools.GetContentEditorLink(ContentEditorMode.Submit, workflowItem,HostName, new ID(command.CommandID));</p>
<p>                sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot; + command.DisplayName + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;/a&amp;amp;amp;amp;amp;gt; or &amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot; + command.DisplayName + &amp;amp;amp;amp;amp;quot; &amp;amp;amp;amp;amp;amp;amp; comment&amp;amp;amp;amp;amp;lt;/a&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;);<br />
            }</p>
<p>            string editLink = Tools.GetContentEditorLink(ContentEditorMode.Editor, workflowItem, HostName, ID.NewID);<br />
            string previewLink = Tools.GetContentEditorLink(ContentEditorMode.Preview, workflowItem,HostName, ID.NewID);</p>
<p>            sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;Edit&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;);<br />
            sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a&amp;amp;amp;amp;amp;gt;Preview&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;);<br />
            sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;a /&amp;amp;amp;amp;amp;gt;Workbox&amp;amp;amp;amp;amp;lt;/li&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;);</p>
<p>            sb.Append(&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;lt;/ul&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;quot;);</p>
<p>            return sb.ToString();<br />
        }<br />
[/code]</p>
<p>Reviewing the command links in the Workbox RSS feed I was able to build a helper class to build the command links in the correct URL format for the links.</p>
<p>[code language="csharp"]<br />
public static string GetContentEditorLink(ContentEditorMode contentEditorMode, Item item, string hostName, ID commandId)<br />
        {<br />
            switch (contentEditorMode)<br />
            {<br />
                case ContentEditorMode.Editor:<br />
                    return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/Applications/Content%20editor.aspx?fo=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;sc_bw=1&amp;amp;amp;amp;amp;quot;);</p>
<p>                case ContentEditorMode.Preview:<br />
                    return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Preview&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString());</p>
<p>                case ContentEditorMode.Submit:<br />
                    return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;, &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Workflow&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;cmd=&amp;amp;amp;amp;amp;quot; + commandId.ToString());</p>
<p>                case ContentEditorMode.SubmitComment:<br />
                    return (&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot; + hostName.Replace(&amp;amp;amp;amp;amp;quot;http://&amp;amp;amp;amp;amp;quot;,&amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;) + &amp;amp;amp;amp;amp;quot;/sitecore/shell/feeds/action.aspx?c=Workflow&amp;amp;amp;amp;amp;amp;id=&amp;amp;amp;amp;amp;quot; + item.ID.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;la=&amp;amp;amp;amp;amp;quot; + item.Language.Name + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;v=&amp;amp;amp;amp;amp;quot; + item.Version.Number.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;cmd=&amp;amp;amp;amp;amp;quot; + commandId.ToString() + &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;amp;nc=1&amp;amp;amp;amp;amp;quot;);<br />
            }<br />
            return &amp;amp;amp;amp;amp;quot;&amp;amp;amp;amp;amp;quot;;<br />
        }<br />
    }<br />
[/code]</p>
<p><strong>Workflow History</strong></p>
<p><a href="https://mikerobbinssitecore.files.wordpress.com/2014/05/20140521-194216-70936959.jpg"><img class="alignnone size-full" src="/assets/20140521-194216-70936959.jpg" alt="20140521-194216-70936959.jpg" /></a></p>
<p><a href="https://mikerobbinssitecore.files.wordpress.com/2014/05/20140521-194216-70936793.jpg"><img class="alignnone size-full" src="/assets/20140521-194216-70936793.jpg" alt="20140521-194216-70936793.jpg" /></a></p>
<p><strong>Source</strong><br />
https://github.com/komainu85/AdvancedEmailAction</p>
<p><strong>Sitecore Marketplace</strong><br />
https://marketplace.sitecore.net/en/Modules/Sitecore_Advanced_Email_Action.aspx</p>

        </section>

        <aside id="sidebar">
          <h3>About Me</h3>
          <p>Senior Product Developer at Sitecore</p>
          <p>Sitecore MVP 2015 / 2016</p>
       
        <h3>Tags</h3>
        <p>
            
              components,</li>
            
              email action,</li>
            
              marketplace,</li>
            
              rss,</li>
            
              workflow,</li>
            
              workflow history,</li>
            
        </p>
    
        <h3>Other Reading</h3>
         
        <h2 id=""></h2>
        <ul class="post-list">
            
          
          
          
        </ul>
       
        <h2 id=""></h2>
        <ul class="post-list">
            
          
          
          
        </ul>
       
        <h2 id=""></h2>
        <ul class="post-list">
            
          
          
          
        </ul>
      

      <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</p>
      
           </aside>

      </div>
    </div>

    
  </body>
</html>