<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>EntityService Sitecore.Services.Client</title>
  <meta name="description" content="Sitecore.Services.Client provides a powerful and flexible method of creating Web API based services within Sitecore. Using the provided interfaces and the re...">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/sitecore/sitecore.services.client/speak/2015/01/06/entityservice-sitecore-service-client.html">
  <link rel="alternate" type="application/rss+xml" title="Mike Robbins" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Mike Robbins</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">EntityService Sitecore.Services.Client</h1>
    <p class="post-meta">
      <time datetime="2015-01-06T18:05:46+00:00" itemprop="datePublished">
        
        Jan 6, 2015
      </time>
      
        • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">{"login"=>"sobek1985", "email"=>"sobek1985@gmail.com", "display_name"=>"Mike Robbins", "first_name"=>"", "last_name"=>""}</span></span>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Sitecore.Services.Client provides a powerful and flexible method of creating Web API based services within Sitecore. Using the provided interfaces and the repository pattern means that you will be building services in a consistent way, allowing you to build more flexible services and reduce the time to develop and maintain them. Sitecore.Services.Client was introduced first in Sitecore 7.5 and supported also in Sitecore 8.<!--more--></p>
<p>Sitecore.Services.Client consists of two separate services. ItemService which allows you to work with standard Sitecore Item class. The other is EntityService which allows you to work with business entities that you create, and allows you implement the business logic as you require.</p>
<p>Both EntityService and ItemService offers a number of ways of consuming the service, allowing you to work via web requests to the rest API, use the JavaScript API or bind to SPEAK components. This post I will be using the JavaScript API with EntityService in context of an Sitecore SPEAK application.</p>
<h2>Model</h2>
<p>The first stage of creating a EntityService based service is to create a Model. This model will define your business entity you wish to work with. All Models have to implement the Sitecore.Services.Core.Model.EntityIdentity class.</p>
<p>[code language="Csharp"]<br />
namespace MikeRobbins.News.Models<br />
{<br />
 public class NewsArticle: Sitecore.Services.Core.Model.EntityIdentity<br />
 {<br />
public string Title{ get; set; }<br />
public string Description{ get; set; }<br />
 }<br />
}<br />
[/code]</p>
<h2>Repository</h2>
<p>Create a repository based on the IRespository interface. E.g Sitecore.Services.Core.IRepository&lt;NewsArticle&gt;. Once you implement the interface you can start to code up the functionality that your EntityService will expose.</p>
<p>IRepository will give you methods for Add, Delete, Exists, FindById, GetAll and Update of your Model. You can however extend this if you require.</p>
<p>[code language="Csharp"]</p>
<p>using MikeRobbins.News.Models;<br />
using System;<br />
using System.Collections.Generic;<br />
using System.Linq;<br />
using System.Web;<br />
using Sitecore.Data;</p>
<p>namespace MikeRobbins.News.Repository<br />
{<br />
 public class NewsArticleRepository : Sitecore.Services.Core.IRepository&lt;NewsArticle&gt;<br />
 {</p>
<p> public void Add(NewsArticle entity)<br />
 {<br />
 throw new NotImplementedException();<br />
 }</p>
<p> public void Delete(NewsArticle entity)<br />
 {<br />
 throw new NotImplementedException();<br />
 }</p>
<p> public bool Exists(NewsArticle entity)<br />
 {<br />
 var newsArticle = Sitecore.Data.Database.GetDatabase(&quot;Master&quot;).GetItem(new ID(entity.Id));</p>
<p> return newsArticle != null;<br />
 }</p>
<p> public NewsArticle FindById(string id)<br />
 {<br />
 var newsArticle = Sitecore.Data.Database.GetDatabase(&quot;master&quot;).GetItem(new ID(id));</p>
<p> if (newsArticle != null)<br />
 {<br />
 return new NewsArticle() { Id = newsArticle.ID.ToString(), DisplayName = newsArticle.DisplayName };<br />
 }<br />
else<br />
{<br />
return null;<br />
}<br />
 }</p>
<p> public IQueryable&lt;NewsArticle&gt; GetAll()<br />
 {<br />
 throw new NotImplementedException();<br />
 }</p>
<p> public void Update(NewsArticle entity)<br />
 {<br />
 }<br />
 }<br />
}[/code]</p>
<h2>Controller</h2>
<p>Next create a controller and add the ServicesController attribute. Implement the EntiryService&lt;T&gt; class where T is your Model. Create a second constructor that creates new instance of your repository class.</p>
<p>[code language="Csharp"]<br />
namespace MikeRobbins.News.Controllers<br />
{<br />
 [ValidateAntiForgeryToken]<br />
 [Sitecore.Services.Core.ServicesController]<br />
 public class NewsArticleController : EntityService&lt;NewsArticle&gt;<br />
 {<br />
 public NewsArticleController(IRepository&lt;NewsArticle&gt; repository)<br />
 : base(repository)<br />
 {<br />
 }</p>
<p> public NewsArticleController()<br />
 : this(new NewsArticleRepository())<br />
 {<br />
 }</p>
<p> }<br />
}<br />
[/code]</p>
<h2>SPEAK PageCode</h2>
<p>Using RequireJS require a reference to the entity service JavaScript library, and update the define element to include the entityService.</p>
<p>[code language="JavaScript"]<br />
require.config({<br />
 paths: {<br />
 entityService: &amp;quot;/sitecore/shell/client/Services/Assets/lib/entityservice&amp;quot;<br />
 }<br />
});</p>
<p>define([&quot;sitecore&quot;, &quot;jquery&quot;, &quot;underscore&quot;, &quot;entityService&quot;], function (Sitecore, $, _, entityService) {<br />
 var News = Sitecore.Definitions.App.extend({</p>
<p> initialized: function () {</p>
<p> },<br />
 });<br />
return News;<br />
});<br />
[/code]</p>
<h2>Working with EntityService via the JavaScript API</h2>
<p>To work with EntityService via the JavaScript API you create an instance of EntityService passing in the url property. The url property is the url of your controller. EntityService is always prefixed with "/sitecore/api/ssc". The next part of the url is the namespace containing your controller with the "." replaced with "-" followed by your controller name.</p>
<p>E.g. If you your controller is in the namespace MikeRobbins.News.Controllers and called NewsArticleController. Your url would be "/sitecore/api/ssc/MikeRobbins/api/ssc/MikeRobbins-News-Controllers/newsarticlearticle"</p>
<h3>Get Entities Example</h3>
<p>Create an instance of EntityService with the service url, you can then call fetchEntities. This will then call the GetAll method within your repository defined within the controller. An array of the entities are then returned.</p>
<p>[code language="JavaScript"]<br />
GetNewsArticles: function () {</p>
<p> var newsService = new entityService({<br />
 url: &quot;/sitecore/api/ssc/MikeRobbins-News-Controllers/newsarticle&quot;<br />
 });</p>
<p> var result = newsService.fetchEntities().execute().then(function (newsArticles) {<br />
  for (var i = 0; i &lt;= newsArticles.length; i++) {<br />
 var title = newsArticles[i].Title;<br />
}<br />
 });</p>
<p> },<br />
[/code]</p>
<h3>Get Entity Example</h3>
<p>Create an instance of EntityService with the service url, you can then call the fetchEntity function passing in an id of an entity. This will then call the FindById method within your repository defined within the controller. An entity class in returned.</p>
<p>[code language="JavaScript"]<br />
GetNewsArticle: function () {</p>
<p> var newsService = new entityService({<br />
 url: &quot;/sitecore/api/ssc/MikeRobbins-News-Controllers/newsarticle&quot;<br />
 });</p>
<p> var result = newsService.fetchEntity(&quot;73e3a4fe-7d42-4ed9-b66e-ad948f340f27&quot;).execute().then(function (newsArticle) {<br />
 var title = newsArticle.Title;<br />
 });</p>
<p> },<br />
[/code]</p>
<h3>Update Entity Example</h3>
<p>Create a an instance of EntityService with the service url, you can then call the fetchEntity function passing in an id of an entity. Once you have an entity returned, make the required changes to the entity. From here you can call the save method, this maps to the update method within the repository. A class is returned containing the updated entity, in the below example I'm popping up a success message in the SPEAK message panel.</p>
<p>[code language="JavaScript"]<br />
UpdateNewsArticle: function () {</p>
<p> var newsService = new entityService({<br />
 url: &quot;/sitecore/api/ssc/MikeRobbins-News-Controllers/newsarticle&quot;<br />
 });</p>
<p> var result = newsService.fetchEntity(&quot;73e3a4fe-7d42-4ed9-b66e-ad948f340f27&quot;).execute().then(function (newsArticle) {<br />
  newsArticle.Title = &quot;Hello World&quot;;</p>
<p> newsArticle.save().execute().then(function (savedNewsArticle) {<br />
 messagePanel.addMessage(&quot;notification&quot;, { text: &quot;Item updated successfully&quot;, actions: [], closable: true, temporary: true });<br />
 });<br />
 });</p>
<p> },<br />
[/code]</p>
<h3>Delete Entity Example</h3>
<p>Create an instance of EntityService with the service url, you can then call the Delete function passing in the entity to delete. This will then call the delete method within your repository defined within the controller.</p>
<p>[code language="JavaScript"]<br />
DeleteNewsArticle: function () {</p>
<p> var newsService = new entityService({<br />
 url: &quot;/sitecore/api/ssc/MikeRobbins-News-Controllers/newsarticle&quot;<br />
 });</p>
<p> var itemToDelete= {<br />
 Id: itemId<br />
 };</p>
<p> var result = newsService.delete(itemToDelete).execute().then(function (newsArticle) {<br />
 });</p>
<p> },<br />
[/code]</p>
<h3>Create Entity Example</h3>
<p>Create an instance of EntityService with the service url. You can then create a new object populating the properties of your entity. From here you can call CreateEntity, passing in the object you created. This will then call the add method within your repository defined within the controller. A class is returned of the newly created entity.</p>
<p>[code language="JavaScript"]<br />
CreateNewsArticle: function () {</p>
<p> var newsService = new entityService({<br />
 url: &amp;quot;/sitecore/api/ssc/MikeRobbins-News-Controllers/newsarticle&amp;quot;<br />
 });</p>
<p>var exampleNewsArticle = {<br />
 Title: &amp;quot;Hello World&amp;quot;,<br />
 Description:&amp;quot;Some content describing the news article.&amp;quot;;<br />
}; </p>
<p> var result = newsService.createEntity(exampleNewsArticle).execute().then(function (newsArticle) {<br />
var title = newsArticle.Title;<br />
 });</p>
<p> },<br />
[/code]</p>
<h3>Tools</h3>
<p>There is a few tools you can use to help with debugging and exploring SSC.</p>
<ol>
<li>Fiddler <a title="http://www.telerik.com/fiddler" href="http://www.telerik.com/fiddler">http://www.telerik.com/fiddler</a></li>
<li>Kevin Obee's Sitecore Glimpse Plugin. Under Sitecore Tab there is a sitecore services section where you can explore your SSC services.
<p>[caption id="attachment_401" align="aligncenter" width="300"]<a href="https://mikerobbinssitecore.files.wordpress.com/2015/01/sitecore-glimpse.png"><img class="size-medium wp-image-401" src="/assets/sitecore-glimpse.png?w=300" alt="Sitecore Glimpse" width="300" height="186" /></a> Sitecore Glimpse[/caption]</li>
<li>POSTman <a title="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm?hl=en" href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm?hl=en" target="_blank">https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm?hl=en</a></li>
<li>Chrome's Console</li>
</ol>
<h3>Further Reading</h3>
<p><a title="Adding custom controller actions" href="http://mikerobbins.co.uk/2015/03/20/sitecore-entity-service-ssc-custom-controller-action/">Adding custom controller actions</a></p>
<p>Jamie Little has written a useful post on how to add custom Authorisation Filters to the controller to restrict access.</p>
<p><a href="https://sitecorejim.wordpress.com/2015/02/18/sitecore-services-client-creating-a-custom-authorisation-filter/">Sitecore services client - Creating a custom authorisation filter</a></p>
<h2>Source</h2>
<p>I have an example Sitecore SPEAK application with SSC implemented available on GitHub. <a href="https://github.com/komainu85/SitecoreSPEAKBulkWorkflows/"> https://github.com/komainu85/SitecoreSPEAKBulkWorkflows/</a></p>
<h2>Master Sitecore</h2>
<p>https://youtube.com/watch?v=g0cVr6CnNKM</p>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Mike Robbins</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              Mike Robbins
            
            </li>
            
            <li><a href="mailto:your-email@example.com">your-email@example.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/komainu85"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">komainu85</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/sobek85"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">sobek85</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
